<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tiempos Litúrgicos del Año</title>
  <!-- Tailwind CSS CDN para un estilo moderno y responsive -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Configuración de Tailwind para usar la fuente Inter y colores personalizados -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
          colors: {
            'adviento-cuaresma': '#5D2E8C', // Un morado más profundo
            'ordinario': '#0A6847',          // Un verde esmeralda
            'navidad-pascua': '#FFFDD0',     // Blanco/Oro pálido
            'linea-actual': '#4285F4',       // Azul de Google
          }
        }
      }
    }
  </script>
  <!-- Importar Inter Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* Estilos personalizados para el diagrama y el tooltip */
    /* **NOTA:** Se eliminó la clase .card de aquí y se aplicaron las propiedades directamente en el HTML */

    .tooltip {
      position: absolute;
      background: rgba(0, 0, 0, 0.85); /* Fondo oscuro semitransparente */
      color: #fff;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 0.75rem; /* Pequeño */
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s, transform 0.2s;
      white-space: nowrap;
      transform: translate(-50%, -120%); /* Centrado y arriba del cursor */
      z-index: 50; /* Asegurar que esté encima de todo */
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    /* Asegurar que el SVG no se deforme y tenga una altura definida */
    #litYear {
      display: block;
    }

    /* Estilo para los textos SVG para mejor contraste */
    .svg-text-shadow {
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 sm:p-8 font-sans">
  <div class="max-w-6xl mx-auto">
    <header class="mb-8 text-center">
      <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-800 tracking-tight">
        Tiempos Litúrgicos del Año
      </h1>
      <p class="text-gray-500 mt-2">Un panel de control del calendario eclesial.</p>
    </header>

    <!-- Panel de Control (Dashboard) con 4 Tarjetas -->
    <!-- En móvil: 1 columna, en tablet: 2 columnas, en escritorio grande: 4 columnas -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
      
      <!-- 1. Ciclo Litúrgico -->
      <div id="card-cycle" class="bg-white p-4 rounded-xl shadow-xl border border-gray-200 transition-all duration-300 hover:scale-[1.02] text-center flex flex-col justify-center">
        <!-- Contenido inyectado por JS -->
      </div>
      
      <!-- 2. Fecha Actual -->
      <div id="card-date" class="bg-white p-4 rounded-xl shadow-xl border border-gray-200 transition-all duration-300 hover:scale-[1.02] text-center">
        <!-- Contenido inyectado por JS -->
      </div>
      
      <!-- 3. Tiempo Actual -->
      <div id="card-time" class="bg-white p-4 rounded-xl shadow-xl border border-gray-200 transition-all duration-300 hover:scale-[1.02] text-center">
        <!-- Contenido inyectado por JS -->
      </div>
      
      <!-- 4. Fecha de Culminación -->
      <div id="card-end" class="bg-white p-4 rounded-xl shadow-xl border border-gray-200 transition-all duration-300 hover:scale-[1.02] text-center">
        <!-- Contenido inyectado por JS -->
      </div>
    </div>
    
    <!-- Contenedor Responsivo del Diagrama -->
    <h2 class="text-xl font-bold text-gray-700 mb-4 mt-8 sm:mt-0">Diagrama Cronológico del Año</h2>
    <div class="w-full max-w-full overflow-x-scroll pb-4 bg-white p-4 rounded-xl shadow-lg">
      <div id="chart" class="relative min-w-[700px] h-[90px]">
        <!-- El SVG se dibuja aquí -->
        <svg id="litYear" width="700" height="90" viewBox="0 0 700 90"></svg>
        <!-- Tooltip -->
        <div class="tooltip" id="tooltip"></div>
      </div>
    </div>
    <!-- /Contenedor Responsivo del Diagrama -->

  </div>

  <script>
    // Configuración de los datos y dimensiones del gráfico
    const SEASONS = [
      // Usando los nombres de colores de Tailwind configurados arriba
      { name: "Adviento",            weeks: 4,  colorClass: "adviento-cuaresma", textColor: "#fff" },
      { name: "Navidad",             weeks: 2,  colorClass: "navidad-pascua",    textColor: "#000", stroke: "#ccc" }, // Borde para el color muy claro
      { name: "Tiempo Ordinario I",  weeks: 6,  colorClass: "ordinario",         textColor: "#fff" },
      { name: "Cuaresma",            weeks: 6,  colorClass: "adviento-cuaresma", textColor: "#fff" },
      { name: "Pascua",              weeks: 7,  colorClass: "navidad-pascua",    textColor: "#000", stroke: "#ccc" },
      { name: "Tiempo Ordinario II", weeks: 27, colorClass: "ordinario",         textColor: "#fff" }
    ];

    // Función para obtener el color real de una clase de Tailwind
    function getColor(className) {
      // Intenta obtener el color del DOM (configuración personalizada de Tailwind)
      const element = document.createElement('div');
      element.className = `bg-${className}`;
      document.body.appendChild(element);
      const color = window.getComputedStyle(element).backgroundColor;
      document.body.removeChild(element);

      // Si no se pudo obtener, usa un fallback basado en el nombre de la clase
      if (!color || color === 'rgba(0, 0, 0, 0)') {
        switch (className) {
          case 'adviento-cuaresma': return '#5D2E8C'; // Morado
          case 'ordinario': return '#0A6847';          // Verde
          case 'navidad-pascua': return '#FFFDD0';     // Blanco/Oro
          case 'linea-actual': return '#4285F4';       // Azul
          default: return '#cccccc';
        }
      }
      return color;
    }

    // Convertir las clases de color a valores HEX/RGB reales después de que Tailwind se inicialice
    SEASONS.forEach(s => {
      s.color = getColor(s.colorClass);
    });

    // 1) Variables de Fechas
    const now   = new Date();
    // Intenta calcular el inicio del año litúrgico (Primer domingo de Adviento).
    // Para simplificar, asumimos el 1 de diciembre, o el anterior si ya pasó.
    let start   = new Date(now.getFullYear(), 11, 1);
    if (now < start) start = new Date(now.getFullYear() - 1, 11, 1);
    const next  = new Date(start.getFullYear() + 1, 11, 1);
    const adventYear = start.getFullYear();

    // 2) Cálculos de Semanas y Estación Actual
    const totalWeeks    = SEASONS.reduce((sum, s) => sum + s.weeks, 0);
    const elapsedWeeks  = (now - start) / (1000 * 60 * 60 * 24 * 7); // Semanas transcurridas
    let weekSum = 0, currentSeason = SEASONS[0], endWeekSum = 0;

    for (const s of SEASONS) {
      weekSum += s.weeks;
      if (elapsedWeeks <= weekSum) {
        currentSeason = s;
        endWeekSum     = weekSum;
        break;
      }
    }

    // Fecha en que culmina el tiempo actual
    const endDate = new Date(start.getTime() + endWeekSum * 7 * 24 * 60 * 60 * 1000);

    // Formato de fechas
    const longDate = now.toLocaleDateString("es-ES", {
      weekday: "long", year: "numeric", month: "long", day: "numeric"
    });
    const endDateString = endDate.toLocaleDateString("es-ES", {
      day: "2-digit", month: "long", year: "numeric"
    });
    const shortDate = now.toLocaleDateString("es-ES", {
        day: "2-digit", month: "2-digit", year: "numeric"
    });

    // 3) Cálculo del Ciclo Litúrgico (A, B o C)
    // Regla: Se basa en el año de Adviento. (Año + 1) % 3 -> 0:A, 1:B, 2:C
    const cycles = ['A', 'B', 'C'];
    const cycleIndex = (adventYear + 1) % 3;
    const currentCycle = cycles[cycleIndex];


    // 4) Actualizar el Panel de Control (Dashboard)
    
    // Tarjeta 1: Ciclo Litúrgico
    document.getElementById("card-cycle").innerHTML = `
        <span class="text-xs font-semibold uppercase text-gray-500 mb-1">Ciclo de la Palabra</span>
        <div class="text-4xl font-extrabold text-adviento-cuaresma">${currentCycle}</div>
        <span class="text-sm text-gray-500">Inició en Adviento ${adventYear}</span>
    `;

    // Tarjeta 2: Fecha Actual
    document.getElementById("card-date").innerHTML = `
        <span class="text-xs font-semibold uppercase text-gray-500 mb-1">Hoy es</span>
        <div class="text-2xl font-bold text-gray-800">${longDate.split(',')[0]}</div>
        <span class="text-lg font-extrabold text-gray-700">${shortDate}</span>
    `;

    // Tarjeta 3: Tiempo Actual
    document.getElementById("card-time").innerHTML = `
        <span class="text-xs font-semibold uppercase text-gray-500 mb-1">Tiempo Litúrgico Actual</span>
        <div class="text-xl font-bold text-gray-800">${currentSeason.name}</div>
        <span class="text-sm font-medium" style="color: ${currentSeason.color}">${currentSeason.weeks} semanas de duración</span>
    `;

    // Tarjeta 4: Culminación del Tiempo
    document.getElementById("card-end").innerHTML = `
        <span class="text-xs font-semibold uppercase text-gray-500 mb-1">Culmina el Tiempo Actual</span>
        <div class="text-xl font-bold text-gray-800">${endDateString.split(',')[0]}</div>
        <span class="text-sm text-gray-500">Para dar inicio al siguiente</span>
    `;


    // 5) Dibujo del Diagrama SVG
    const svg     = document.getElementById("litYear");
    const tooltip = document.getElementById("tooltip");
    const chart   = document.getElementById("chart");

    // Dimensiones del SVG, ajustadas para el viewBox
    const svgWidth = +svg.getAttribute("width");
    const svgHeight = +svg.getAttribute("height");
    const padding = 10;
    const chartW  = svgWidth - 2 * padding;
    const chartH  = svgHeight - 2 * padding; // Altura total de la barra
    let   currentX  = padding;

    SEASONS.forEach((s, index) => {
      const segW = (s.weeks / totalWeeks) * chartW;

      // 5.1) Crear el rectángulo (Barra de tiempo)
      const rect = document.createElementNS(svg.namespaceURI, "rect");
      rect.setAttribute("x",      currentX);
      rect.setAttribute("y",      padding);
      rect.setAttribute("width",  segW);
      rect.setAttribute("height", chartH);
      rect.setAttribute("fill",   s.color);
      // Aplicar borde redondeado a los extremos (solo a los primeros y últimos segmentos)
      if (index === 0) {
        rect.setAttribute("rx", 5); // Radio de esquina horizontal
        rect.setAttribute("ry", 5); // Radio de esquina vertical
      } else if (index === SEASONS.length - 1) {
        rect.setAttribute("rx", 5);
        rect.setAttribute("ry", 5);
      }
      // Borde sutil para los segmentos claros
      if (s.stroke) {
        rect.setAttribute("stroke", s.stroke);
        rect.setAttribute("stroke-width", 1);
      }
      svg.appendChild(rect);

      // 5.2) Crear la etiqueta de texto
      const text = document.createElementNS(svg.namespaceURI, "text");
      text.setAttribute("x",           currentX + segW / 2);
      text.setAttribute("y",           padding + chartH / 2 + 5); // Centrado verticalmente
      text.setAttribute("fill",        s.textColor);
      text.setAttribute("font-size",   "14"); // Un poco más grande
      text.setAttribute("font-weight", "600");
      text.setAttribute("text-anchor", "middle");
      text.setAttribute("class",       "svg-text-shadow"); // Sombra para mejor lectura
      // Solo mostrar el nombre si hay espacio
      const truncatedName = segW > 60 ? s.name : (s.name.includes("Ordinario") ? 'T.O.' : s.name.substring(0, 3) + '.');
      text.textContent = truncatedName;
      svg.appendChild(text);

      // 5.3) Tooltips
      rect.addEventListener("mousemove", e => {
        const box = chart.getBoundingClientRect();
        tooltip.textContent   = `${s.name} (${s.weeks} semanas)`;
        tooltip.style.left    = `${e.clientX - box.left}px`;
        tooltip.style.top     = `${e.clientY - box.top}px`;
        tooltip.style.opacity = 1;
      });
      rect.addEventListener("mouseout", () => {
        tooltip.style.opacity = 0;
      });

      currentX += segW;
    });

    // 6) Línea de Fecha Actual
    const linePos = ((now - start) / (next - start)) * chartW + padding; // Posición X relativa
    const line = document.createElementNS(svg.namespaceURI, "line");
    line.setAttribute("x1", linePos);
    line.setAttribute("y1", padding - 5);
    line.setAttribute("x2", linePos);
    line.setAttribute("y2", chartH + padding + 5);
    line.setAttribute("stroke", getColor('linea-actual')); // Usar color personalizado
    line.setAttribute("stroke-width", 3); // Un poco más gruesa
    line.setAttribute("stroke-linecap", "round");
    svg.appendChild(line);

    // 6.1) Tooltip de Fecha Actual
    line.addEventListener("mousemove", e => {
      const box = chart.getBoundingClientRect();
      tooltip.textContent   = `Hoy: ${shortDate}`;
      tooltip.style.left    = `${e.clientX - box.left}px`;
      tooltip.style.top     = `${e.clientY - box.top}px`;
      tooltip.style.opacity = 1;
    });
    line.addEventListener("mouseout", () => {
      tooltip.style.opacity = 0;
    });
  </script>
</body>
</html>
